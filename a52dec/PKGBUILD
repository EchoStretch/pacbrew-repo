pkgname=ps5-payload-a52dec
pkgver=0.8.0
pkgrel=1
pkgdesc='Library for decoding ATSC A/52 (AC-3) audio streams'
arch=('any')
url='https://git.adelielinux.org/community/a52dec/'
license=('GPL-2.0-or-later')
source=("https://mirrors.slackware.com/slackware/slackware64-current/slackware64/l/a52dec-$pkgver-x86_64-1.txz")
sha256sums=('dfeecce4f7ab1367bc39280c46a325b0aa035341b8da83e1f5ca28f278bf1a60')
options=(!strip libtool staticlibs)
groups=('ps5-payload-dev')
makedepends=('ps5-payload-sdk')

prepare() {
    if [ -z "${PS5_PAYLOAD_SDK}" ]; then
	export PS5_PAYLOAD_SDK=/opt/ps5-payload-sdk
    fi

    cd a52dec-v$pkgver
    autoreconf -fi
}

build() {
    source "${PS5_PAYLOAD_SDK}/toolchain/prospero.sh"
    cd a52dec-v$pkgver

    ./configure --prefix="${PREFIX}" --host=x86_64-pc-freebsd \
		--enable-static --disable-shared \
		--disable-oss
    ${MAKE}
}

package() {
    source "${PS5_PAYLOAD_SDK}/toolchain/prospero.sh"
    cd a52dec-v$pkgver

    export DESTDIR="${pkgdir}/${DESTDIR}"
    make install
    install -Dm644 -t "${DESTDIR}/${PREFIX}/include/a52dec/" liba52/a52_internal.h

    ${PS5_CROSS_FIX_ROOT} "${DESTDIR}/${PREFIX}"

}
